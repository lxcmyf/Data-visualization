<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECharts Line Chart</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        #chart {
            width: 100%;
            height: 500px;
        }
    </style>
</head>
<body>
<h1>ECharts Line Chart Example</h1>
<div id="chart"></div>

<script>
        $(document).ready(function () {
            // Initialize the chart instance
            var chart = echarts.init(document.getElementById('chart'));

            // Default chart options
            var options = {
                title: {
                    text: 'Height vs Cost and Transaction Number'
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function (params) {
                        // Display height, cost, txNum, and updateTime in tooltip
                        var tooltipText = params.map(function (item) {
                            return `${item.seriesName}: ${item.value}`;
                        }).join('<br>');

                        // Extract updateTime from the first data point (assumes consistent updateTime for the axis point)
                        var updateTime = params[0]?.data.updateTime || 'N/A';
                        return `${tooltipText}<br>Update Time: ${updateTime}`;
                    }
                },
                legend: {
                    data: ['Cost', 'Transaction Number'],
                    selected: {
                        'Cost': true,
                        'Transaction Number': true
                    }
                },
                xAxis: {
                    type: 'category',
                    name: 'Height',
                    data: []
                },
                yAxis: {
                    type: 'value',
                    name: 'Value'
                },
                series: [
                    {
                        name: 'Cost',
                        type: 'line',
                        data: []
                    },
                    {
                        name: 'Transaction Number',
                        type: 'line',
                        data: []
                    }
                ]
            };

            // Set the default options on the chart
            chart.setOption(options);

            // Fetch data using AJAX
            $.ajax({
                url: '/getBlockGenerateInfo',
                method: 'GET',
                success: function (response) {
                    // Parse the response and transform it into chart data
                    var heights = [];
                    var costData = [];
                    var txNumData = [];

                    response.forEach(function (item) {
                        heights.push(item.height);
                        costData.push({ value: item.cost, updateTime: item.updateTime });
                        txNumData.push({ value: item.txNum, updateTime: item.updateTime });
                    });

                    options.xAxis.data = heights;
                    options.series[0].data = costData;
                    options.series[1].data = txNumData;

                    // Update the chart with new data
                    chart.setOption(options);
                },
                error: function (error) {
                    console.error('Error fetching data:', error);
                }
            });
        });
    </script>
</body>
</html>
